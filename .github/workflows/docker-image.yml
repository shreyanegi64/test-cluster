name: Check YAML Files and Changes

on:
  push:
    branches:
      - main # or your default branch

jobs:
  check_files:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: List YAML files
      id: list_yaml_files
      run: |
        echo "Listing all YAML files..."
        find . -name "*.yaml" -o -name "*.yml" > all_yaml_files.txt
        cat all_yaml_files.txt

    # - name: List changed YAML files in last commit
    #   id: list_changed_files
    #   run: |
    #     echo "Listing changed YAML files in the last commit..."
    #     git diff --name-only HEAD~1 HEAD | grep -E '\.(yaml|yml)$' > changed_yaml_files.txt
    #     if [ -s changed_yaml_files.txt ]; then
    #       echo "Changed YAML files:"
    #       cat changed_yaml_files.txt
    #     else
    #       echo "No YAML files changed in the last commit."
    #     fi

    - name: Check for YAML file changes in the last commit
      id: check_yaml_changes_last_commit
      run: |
        echo "Fetching commit details..."
        current_commit=$(git rev-parse HEAD)

        echo "Listing changed YAML files in the current commit..."
        changed_files=$(git diff-tree --no-commit-id --name-only -r $current_commit | grep -E '\.(yaml|yml)$')
        
        if [ -n "$changed_files" ]; then
          echo "Changed YAML files:"
          echo "$changed_files"
        else
          echo "No YAML files changed in the current commit."
        fi
        
        

